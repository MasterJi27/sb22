import{L as ae,R as Ue,U as qe,a as Ve,O as We,P as $e,S as Xe,b as le,N as Ye,A as Ke,W as Je,C as Qe,B as Ze,c as et,V as tt,d as oe,e as nt,f as rt,T as ot}from"./three-BK868ntV.js";import{r as j,j as B}from"./react-jpDy1dhu.js";import{R as it,c as K}from"./react-reconciler-C9sZhDML.js";import{j as st}from"./react-use-measure-CTgYlpmf.js";import{F as at,u as lt}from"./its-fine-Bz-ylivt.js";import"./react-dom-D8B1dCqa.js";import{_ as ct}from"./@babel-CF3RwP-h.js";function Ut(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ut(e){let n;const o=new Set,i=(p,t)=>{const r=typeof p=="function"?p(n):p;if(r!==n){const s=n;n=t?r:Object.assign({},n,r),o.forEach(l=>l(n,s))}},f=()=>n,v=(p,t=f,r=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=t(n);function l(){const u=t(n);if(!r(s,u)){const S=s;p(s=u,S)}}return o.add(l),()=>o.delete(l)},d={setState:i,getState:f,subscribe:(p,t,r)=>t||r?v(p,t,r):(o.add(p),()=>o.delete(p)),destroy:()=>o.clear()};return n=e(i,f,d),d}const ft=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),we=ft?j.useEffect:j.useLayoutEffect;function dt(e){const n=typeof e=="function"?ut(e):e,o=(i=n.getState,f=Object.is)=>{const[,v]=j.useReducer(b=>b+1,0),y=n.getState(),g=j.useRef(y),d=j.useRef(i),p=j.useRef(f),t=j.useRef(!1),r=j.useRef();r.current===void 0&&(r.current=i(y));let s,l=!1;(g.current!==y||d.current!==i||p.current!==f||t.current)&&(s=i(y),l=!f(r.current,s)),we(()=>{l&&(r.current=s),g.current=y,d.current=i,p.current=f,t.current=!1});const u=j.useRef(y);we(()=>{const b=()=>{try{const c=n.getState(),m=d.current(c);p.current(r.current,m)||(g.current=c,r.current=m,v())}catch{t.current=!0,v()}},a=n.subscribe(b);return n.getState()!==u.current&&b(),a},[]);const S=l?s:r.current;return j.useDebugValue(S),S};return Object.assign(o,n),o[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[o,n];return{next(){const f=i.length<=0;return{value:i.shift(),done:f}}}},o}var Te={exports:{}},ke={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(h,C){var _=h.length;h.push(C);e:for(;0<_;){var E=_-1>>>1,D=h[E];if(0<f(D,C))h[E]=C,h[_]=D,_=E;else break e}}function o(h){return h.length===0?null:h[0]}function i(h){if(h.length===0)return null;var C=h[0],_=h.pop();if(_!==C){h[0]=_;e:for(var E=0,D=h.length,A=D>>>1;E<A;){var F=2*(E+1)-1,U=h[F],q=F+1,te=h[q];if(0>f(U,_))q<D&&0>f(te,U)?(h[E]=te,h[q]=_,E=q):(h[E]=U,h[F]=_,E=F);else if(q<D&&0>f(te,_))h[E]=te,h[q]=_,E=q;else break e}}return C}function f(h,C){var _=h.sortIndex-C.sortIndex;return _!==0?_:h.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;e.unstable_now=function(){return v.now()}}else{var y=Date,g=y.now();e.unstable_now=function(){return y.now()-g}}var d=[],p=[],t=1,r=null,s=3,l=!1,u=!1,S=!1,b=typeof setTimeout=="function"?setTimeout:null,a=typeof clearTimeout=="function"?clearTimeout:null,c=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(h){for(var C=o(p);C!==null;){if(C.callback===null)i(p);else if(C.startTime<=h)i(p),C.sortIndex=C.expirationTime,n(d,C);else break;C=o(p)}}function P(h){if(S=!1,m(h),!u)if(o(d)!==null)u=!0,H(M);else{var C=o(p);C!==null&&G(P,C.startTime-h)}}function M(h,C){u=!1,S&&(S=!1,a(k),k=-1),l=!0;var _=s;try{for(m(C),r=o(d);r!==null&&(!(r.expirationTime>C)||h&&!w());){var E=r.callback;if(typeof E=="function"){r.callback=null,s=r.priorityLevel;var D=E(r.expirationTime<=C);C=e.unstable_now(),typeof D=="function"?r.callback=D:r===o(d)&&i(d),m(C)}else i(d);r=o(d)}if(r!==null)var A=!0;else{var F=o(p);F!==null&&G(P,F.startTime-C),A=!1}return A}finally{r=null,s=_,l=!1}}var R=!1,T=null,k=-1,I=5,x=-1;function w(){return!(e.unstable_now()-x<I)}function O(){if(T!==null){var h=e.unstable_now();x=h;var C=!0;try{C=T(!0,h)}finally{C?z():(R=!1,T=null)}}else R=!1}var z;if(typeof c=="function")z=function(){c(O)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,V=N.port2;N.port1.onmessage=O,z=function(){V.postMessage(null)}}else z=function(){b(O,0)};function H(h){T=h,R||(R=!0,z())}function G(h,C){k=b(function(){h(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(h){h.callback=null},e.unstable_continueExecution=function(){u||l||(u=!0,H(M))},e.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<h?Math.floor(1e3/h):5},e.unstable_getCurrentPriorityLevel=function(){return s},e.unstable_getFirstCallbackNode=function(){return o(d)},e.unstable_next=function(h){switch(s){case 1:case 2:case 3:var C=3;break;default:C=s}var _=s;s=C;try{return h()}finally{s=_}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(h,C){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var _=s;s=h;try{return C()}finally{s=_}},e.unstable_scheduleCallback=function(h,C,_){var E=e.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?E+_:E):_=E,h){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=_+D,h={id:t++,callback:C,priorityLevel:h,startTime:_,expirationTime:D,sortIndex:-1},_>E?(h.sortIndex=_,n(p,h),o(d)===null&&h===o(p)&&(S?(a(k),k=-1):S=!0,G(P,_-E))):(h.sortIndex=D,n(d,h),u||l||(u=!0,H(M))),h},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(h){var C=s;return function(){var _=s;s=C;try{return h.apply(this,arguments)}finally{s=_}}}})(ke);Te.exports=ke;var Se=Te.exports;const ye={},pt=e=>void Object.assign(ye,e);function vt(e,n){function o(t,{args:r=[],attach:s,...l},u){let S=`${t[0].toUpperCase()}${t.slice(1)}`,b;if(t==="primitive"){if(l.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=l.object;b=X(a,{type:t,root:u,attach:s,primitive:!0})}else{const a=ye[S];if(!a)throw new Error(`R3F: ${S} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");b=X(new a(...r),{type:t,root:u,attach:s,memoizedProps:{args:r}})}return b.__r3f.attach===void 0&&(b.isBufferGeometry?b.__r3f.attach="geometry":b.isMaterial&&(b.__r3f.attach="material")),S!=="inject"&&fe(b,l),b}function i(t,r){let s=!1;if(r){var l,u;(l=r.__r3f)!=null&&l.attach?ue(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),s=!0),s||(u=t.__r3f)==null||u.objects.push(r),r.__r3f||X(r,{}),r.__r3f.parent=t,be(r),Y(r)}}function f(t,r,s){let l=!1;if(r){var u,S;if((u=r.__r3f)!=null&&u.attach)ue(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:r});const b=t.children.filter(c=>c!==r),a=b.indexOf(s);t.children=[...b.slice(0,a),r,...b.slice(a)],l=!0}l||(S=t.__r3f)==null||S.objects.push(r),r.__r3f||X(r,{}),r.__r3f.parent=t,be(r),Y(r)}}function v(t,r,s=!1){t&&[...t].forEach(l=>y(r,l,s))}function y(t,r,s){if(r){var l,u,S;if(r.__r3f&&(r.__r3f.parent=null),(l=t.__r3f)!=null&&l.objects&&(t.__r3f.objects=t.__r3f.objects.filter(P=>P!==r)),(u=r.__r3f)!=null&&u.attach)Re(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var b;t.remove(r),(b=r.__r3f)!=null&&b.root&&St(ie(r),r)}const c=(S=r.__r3f)==null?void 0:S.primitive,m=!c&&(s===void 0?r.dispose!==null:s);if(!c){var a;v((a=r.__r3f)==null?void 0:a.objects,r,m),v(r.children,r,m)}if(delete r.__r3f,m&&r.dispose&&r.type!=="Scene"){const P=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Se.unstable_scheduleCallback(Se.unstable_IdlePriority,P):P()}Y(t)}}function g(t,r,s,l){var u;const S=(u=t.__r3f)==null?void 0:u.parent;if(!S)return;const b=o(r,s,t.__r3f.root);if(t.children){for(const a of t.children)a.__r3f&&i(b,a);t.children=t.children.filter(a=>!a.__r3f)}t.__r3f.objects.forEach(a=>i(b,a)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||y(S,t),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),i(S,b),b.raycast&&b.__r3f.eventCount&&ie(b).getState().internal.interaction.push(b),[l,l.alternate].forEach(a=>{a!==null&&(a.stateNode=b,a.ref&&(typeof a.ref=="function"?a.ref(b):a.ref.current=b))})}const d=()=>{};return{reconciler:it({createInstance:o,removeChild:y,appendChild:i,appendInitialChild:i,insertBefore:f,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const s=t.getState().scene;s.__r3f&&(s.__r3f.root=t,i(s,r))},removeChildFromContainer:(t,r)=>{r&&y(t.getState().scene,r)},insertInContainerBefore:(t,r,s)=>{if(!r||!s)return;const l=t.getState().scene;l.__r3f&&f(l,r,s)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t==null?void 0:t.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,s,l){var u;if(((u=t==null?void 0:t.__r3f)!=null?u:{}).primitive&&l.object&&l.object!==t)return[!0];{const{args:b=[],children:a,...c}=l,{args:m=[],children:P,...M}=s;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((T,k)=>T!==m[k]))return[!0];const R=Fe(t,c,M,!0);return R.changes.length?[!1,R]:null}},commitUpdate(t,[r,s],l,u,S,b){r?g(t,l,S,b):fe(t,s)},commitMount(t,r,s,l){var u;const S=(u=t.__r3f)!=null?u:{};t.raycast&&S.handlers&&S.eventCount&&ie(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>X(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:s,parent:l}=(r=t.__r3f)!=null?r:{};s&&l&&Re(l,t,s),t.isObject3D&&(t.visible=!1),Y(t)},unhideInstance(t,r){var s;const{attach:l,parent:u}=(s=t.__r3f)!=null?s:{};l&&u&&ue(u,t,l),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),Y(t)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>n?n():K.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:fe}}var Ce,Ee;const ce=e=>"colorSpace"in e||"outputColorSpace"in e,xe=()=>{var e;return(e=ye.ColorManagement)!=null?e:null},De=e=>e&&e.isOrthographicCamera,ht=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((Ce=window.document)!=null&&Ce.createElement||((Ee=window.navigator)==null?void 0:Ee.product)==="ReactNative")?j.useLayoutEffect:j.useEffect;function Ae(e){const n=j.useRef(e);return ee(()=>void(n.current=e),[e]),n}function mt({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ie extends j.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}Ie.getDerivedStateFromError=()=>({error:!0});const Le="__default",Pe=new Map,gt=e=>e&&!!e.memoized&&!!e.changes;function ze(e){var n;const o=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const Q=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()};function ie(e){let n=e.__r3f.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:o="shallow",objects:i="reference",strict:f=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===n;const v=L.obj(e);if(v&&i==="reference")return e===n;const y=L.arr(e);if(y&&o==="reference")return e===n;if((y||v)&&e===n)return!0;let g;for(g in e)if(!(g in n))return!1;if(v&&o==="shallow"&&i==="shallow"){for(g in f?n:e)if(!L.equ(e[g],n[g],{strict:f,objects:"reference"}))return!1}else for(g in f?n:e)if(e[g]!==n[g])return!1;if(L.und(g)){if(y&&e.length===0&&n.length===0||v&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function bt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function X(e,n){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function ge(e,n){let o=e;if(n.includes("-")){const i=n.split("-"),f=i.pop();return o=i.reduce((v,y)=>v[y],e),{target:o,key:f}}else return{target:o,key:n}}const Me=/-\d+$/;function ue(e,n,o){if(L.str(o)){if(Me.test(o)){const v=o.replace(Me,""),{target:y,key:g}=ge(e,v);Array.isArray(y[g])||(y[g]=[])}const{target:i,key:f}=ge(e,o);n.__r3f.previousAttach=i[f],i[f]=n}else n.__r3f.previousAttach=o(e,n)}function Re(e,n,o){var i,f;if(L.str(o)){const{target:v,key:y}=ge(e,o),g=n.__r3f.previousAttach;g===void 0?delete v[y]:v[y]=g}else(i=n.__r3f)==null||i.previousAttach==null||i.previousAttach(e,n);(f=n.__r3f)==null||delete f.previousAttach}function Fe(e,{children:n,key:o,ref:i,...f},{children:v,key:y,ref:g,...d}={},p=!1){const t=e.__r3f,r=Object.entries(f),s=[];if(p){const u=Object.keys(d);for(let S=0;S<u.length;S++)f.hasOwnProperty(u[S])||r.unshift([u[S],Le+"remove"])}r.forEach(([u,S])=>{var b;if((b=e.__r3f)!=null&&b.primitive&&u==="object"||L.equ(S,d[u]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(u))return s.push([u,S,!0,[]]);let a=[];u.includes("-")&&(a=u.split("-")),s.push([u,S,!1,a]);for(const c in f){const m=f[c];c.startsWith(`${u}-`)&&s.push([c,m,!1,c.split("-")])}});const l={...f};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(l.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(l.attach=t.memoizedProps.attach),{memoized:l,changes:s}}const yt=typeof process<"u"&&!1;function fe(e,n){var o;const i=e.__r3f,f=i==null?void 0:i.root,v=f==null||f.getState==null?void 0:f.getState(),{memoized:y,changes:g}=gt(n)?n:Fe(e,n),d=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=y);for(let s=0;s<g.length;s++){let[l,u,S,b]=g[s];if(ce(e)){const P="srgb",M="srgb-linear";l==="encoding"?(l="colorSpace",u=u===3001?P:M):l==="outputEncoding"&&(l="outputColorSpace",u=u===3001?P:M)}let a=e,c=a[l];if(b.length&&(c=b.reduce((m,P)=>m[P],e),!(c&&c.set))){const[m,...P]=b.reverse();a=P.reverse().reduce((M,R)=>M[R],e),l=m}if(u===Le+"remove")if(a.constructor){let m=Pe.get(a.constructor);m||(m=new a.constructor,Pe.set(a.constructor,m)),u=m[l]}else u=0;if(S&&i)u?i.handlers[l]=u:delete i.handlers[l],i.eventCount=Object.keys(i.handlers).length;else if(c&&c.set&&(c.copy||c instanceof ae)){if(Array.isArray(u))c.fromArray?c.fromArray(u):c.set(...u);else if(c.copy&&u&&u.constructor&&(yt?c.constructor.name===u.constructor.name:c.constructor===u.constructor))c.copy(u);else if(u!==void 0){var p;const m=(p=c)==null?void 0:p.isColor;!m&&c.setScalar?c.setScalar(u):c instanceof ae&&u instanceof ae?c.mask=u.mask:c.set(u),!xe()&&v&&!v.linear&&m&&c.convertSRGBToLinear()}}else{var t;if(a[l]=u,(t=a[l])!=null&&t.isTexture&&a[l].format===Ue&&a[l].type===qe&&v){const m=a[l];ce(m)&&ce(v.gl)?m.colorSpace=v.gl.outputColorSpace:m.encoding=v.gl.outputEncoding}}Y(e)}if(i&&i.parent&&e.raycast&&d!==i.eventCount){const s=ie(e).getState().internal,l=s.interaction.indexOf(e);l>-1&&s.interaction.splice(l,1),i.eventCount&&s.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(o=e.__r3f)!=null&&o.parent&&be(e),e}function Y(e){var n,o;const i=(n=e.__r3f)==null||(o=n.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function be(e){e.onUpdate==null||e.onUpdate(e)}function _t(e,n){e.manual||(De(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function wt(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return K.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return K.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return K.ContinuousEventPriority;default:return K.DefaultEventPriority}}function Be(e,n,o,i){const f=o.get(n);f&&(o.delete(n),o.size===0&&(e.delete(i),f.target.releasePointerCapture(i)))}function St(e,n){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==n),o.initialHits=o.initialHits.filter(i=>i!==n),o.hovered.forEach((i,f)=>{(i.eventObject===n||i.object===n)&&o.hovered.delete(f)}),o.capturedMap.forEach((i,f)=>{Be(o.capturedMap,n,i,f)})}function Ct(e){function n(d){const{internal:p}=e.getState(),t=d.offsetX-p.initialClick[0],r=d.offsetY-p.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function o(d){return d.filter(p=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=p.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function i(d,p){const t=e.getState(),r=new Set,s=[],l=p?p(t.internal.interaction):t.internal.interaction;for(let a=0;a<l.length;a++){const c=Q(l[a]);c&&(c.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(d,t);function u(a){const c=Q(a);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var m;c.events.compute==null||c.events.compute(d,c,(m=c.previousRoot)==null?void 0:m.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(a,!0):[]}let S=l.flatMap(u).sort((a,c)=>{const m=Q(a.object),P=Q(c.object);return!m||!P?a.distance-c.distance:P.events.priority-m.events.priority||a.distance-c.distance}).filter(a=>{const c=ne(a);return r.has(c)?!1:(r.add(c),!0)});t.events.filter&&(S=t.events.filter(S,t));for(const a of S){let c=a.object;for(;c;){var b;(b=c.__r3f)!=null&&b.eventCount&&s.push({...a,eventObject:c}),c=c.parent}}if("pointerId"in d&&t.internal.capturedMap.has(d.pointerId))for(let a of t.internal.capturedMap.get(d.pointerId).values())r.has(ne(a.intersection))||s.push(a.intersection);return s}function f(d,p,t,r){const s=e.getState();if(d.length){const l={stopped:!1};for(const u of d){const S=Q(u.object)||s,{raycaster:b,pointer:a,camera:c,internal:m}=S,P=new oe(a.x,a.y,0).unproject(c),M=x=>{var w,O;return(w=(O=m.capturedMap.get(x))==null?void 0:O.has(u.eventObject))!=null?w:!1},R=x=>{const w={intersection:u,target:p.target};m.capturedMap.has(x)?m.capturedMap.get(x).set(u.eventObject,w):m.capturedMap.set(x,new Map([[u.eventObject,w]])),p.target.setPointerCapture(x)},T=x=>{const w=m.capturedMap.get(x);w&&Be(m.capturedMap,u.eventObject,w,x)};let k={};for(let x in p){let w=p[x];typeof w!="function"&&(k[x]=w)}let I={...u,...k,pointer:a,intersections:d,stopped:l.stopped,delta:t,unprojectedPoint:P,ray:b.ray,camera:c,stopPropagation(){const x="pointerId"in p&&m.capturedMap.get(p.pointerId);if((!x||x.has(u.eventObject))&&(I.stopped=l.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(w=>w.eventObject===u.eventObject))){const w=d.slice(0,d.indexOf(u));v([...w,u])}},target:{hasPointerCapture:M,setPointerCapture:R,releasePointerCapture:T},currentTarget:{hasPointerCapture:M,setPointerCapture:R,releasePointerCapture:T},nativeEvent:p};if(r(I),l.stopped===!0)break}}return d}function v(d){const{internal:p}=e.getState();for(const t of p.hovered.values())if(!d.length||!d.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const s=t.eventObject.__r3f,l=s==null?void 0:s.handlers;if(p.hovered.delete(ne(t)),s!=null&&s.eventCount){const u={...t,intersections:d};l.onPointerOut==null||l.onPointerOut(u),l.onPointerLeave==null||l.onPointerLeave(u)}}}function y(d,p){for(let t=0;t<p.length;t++){const r=p[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(d)}}function g(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return p=>{const{internal:t}=e.getState();"pointerId"in p&&t.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(p.pointerId)&&(t.capturedMap.delete(p.pointerId),v([]))})}}return function(t){const{onPointerMissed:r,internal:s}=e.getState();s.lastEvent.current=t;const l=d==="onPointerMove",u=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",b=i(t,l?o:void 0),a=u?n(t):0;d==="onPointerDown"&&(s.initialClick=[t.offsetX,t.offsetY],s.initialHits=b.map(m=>m.eventObject)),u&&!b.length&&a<=2&&(y(t,s.interaction),r&&r(t)),l&&v(b);function c(m){const P=m.eventObject,M=P.__r3f,R=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(l){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const T=ne(m),k=s.hovered.get(T);k?k.stopped&&m.stopPropagation():(s.hovered.set(T,m),R.onPointerOver==null||R.onPointerOver(m),R.onPointerEnter==null||R.onPointerEnter(m))}R.onPointerMove==null||R.onPointerMove(m)}else{const T=R[d];T?(!u||s.initialHits.includes(P))&&(y(t,s.interaction.filter(k=>!s.initialHits.includes(k))),T(m)):u&&s.initialHits.includes(P)&&y(t,s.interaction.filter(k=>!s.initialHits.includes(k)))}}f(b,t,a,c)}}return{handlePointer:g}}const He=e=>!!(e!=null&&e.render),Ne=j.createContext(null),Et=(e,n)=>{const o=dt((g,d)=>{const p=new oe,t=new oe,r=new oe;function s(a=d().camera,c=t,m=d().size){const{width:P,height:M,top:R,left:T}=m,k=P/M;c.isVector3?r.copy(c):r.set(...c);const I=a.getWorldPosition(p).distanceTo(r);if(De(a))return{width:P/a.zoom,height:M/a.zoom,top:R,left:T,factor:1,distance:I,aspect:k};{const x=a.fov*Math.PI/180,w=2*Math.tan(x/2)*I,O=w*(P/M);return{width:O,height:w,top:R,left:T,factor:P/O,distance:I,aspect:k}}}let l;const u=a=>g(c=>({performance:{...c.performance,current:a}})),S=new nt;return{set:g,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(d(),a),advance:(a,c)=>n(a,c,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rt,pointer:S,mouse:S,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=d();l&&clearTimeout(l),a.performance.current!==a.performance.min&&u(a.performance.min),l=setTimeout(()=>u(d().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:a=>g(c=>({...c,events:{...c.events,...a}})),setSize:(a,c,m,P,M)=>{const R=d().camera,T={width:a,height:c,top:P||0,left:M||0,updateStyle:m};g(k=>({size:T,viewport:{...k.viewport,...s(R,t,T)}}))},setDpr:a=>g(c=>{const m=ze(a);return{viewport:{...c.viewport,dpr:m,initialDpr:c.viewport.initialDpr||m}}}),setFrameloop:(a="always")=>{const c=d().clock;c.stop(),c.elapsedTime=0,a!=="never"&&(c.start(),c.elapsedTime=0),g(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:j.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,c,m)=>{const P=d().internal;return P.priority=P.priority+(c>0?1:0),P.subscribers.push({ref:a,priority:c,store:m}),P.subscribers=P.subscribers.sort((M,R)=>M.priority-R.priority),()=>{const M=d().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(c>0?1:0),M.subscribers=M.subscribers.filter(R=>R.ref!==a))}}}}}),i=o.getState();let f=i.size,v=i.viewport.dpr,y=i.camera;return o.subscribe(()=>{const{camera:g,size:d,viewport:p,gl:t,set:r}=o.getState();if(d.width!==f.width||d.height!==f.height||p.dpr!==v){var s;f=d,v=p.dpr,_t(g,d),t.setPixelRatio(p.dpr);const l=(s=d.updateStyle)!=null?s:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(d.width,d.height,l)}g!==y&&(y=g,r(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(g)}})))}),o.subscribe(g=>e(g)),o};let re,Pt=new Set,Mt=new Set,Rt=new Set;function de(e,n){if(e.size)for(const{callback:o}of e.values())o(n)}function Z(e,n){switch(e){case"before":return de(Pt,n);case"after":return de(Mt,n);case"tail":return de(Rt,n)}}let pe,ve;function he(e,n,o){let i=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(i=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),pe=n.internal.subscribers,re=0;re<pe.length;re++)ve=pe[re],ve.ref.current(ve.store.getState(),i,o);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function jt(e){let n=!1,o=!1,i,f,v;function y(p){f=requestAnimationFrame(y),n=!0,i=0,Z("before",p),o=!0;for(const r of e.values()){var t;v=r.store.getState(),v.internal.active&&(v.frameloop==="always"||v.internal.frames>0)&&!((t=v.gl.xr)!=null&&t.isPresenting)&&(i+=he(p,v))}if(o=!1,Z("after",p),i===0)return Z("tail",p),n=!1,cancelAnimationFrame(f)}function g(p,t=1){var r;if(!p)return e.forEach(s=>g(s.store.getState(),t));(r=p.gl.xr)!=null&&r.isPresenting||!p.internal.active||p.frameloop==="never"||(t>1?p.internal.frames=Math.min(60,p.internal.frames+t):o?p.internal.frames=2:p.internal.frames=1,n||(n=!0,requestAnimationFrame(y)))}function d(p,t=!0,r,s){if(t&&Z("before",p),r)he(p,r,s);else for(const l of e.values())he(p,l.store.getState());t&&Z("after",p)}return{loop:y,invalidate:g,advance:d}}function Ot(){const e=j.useContext(Ne);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function qt(e,n=0){const o=Ot(),i=o.getState().internal.subscribe,f=Ae(e);return ee(()=>i(f,n,o),[n,i,o]),null}const J=new Map,{invalidate:je,advance:Oe}=jt(J),{reconciler:se,applyProps:W}=vt(J,wt),$={objects:"shallow",strict:!1},Tt=(e,n)=>{const o=typeof e=="function"?e(n):e;return He(o)?o:new Je({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function kt(e,n){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(n){const{width:i,height:f,top:v,left:y,updateStyle:g=o}=n;return{width:i,height:f,top:v,left:y,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:f,top:v,left:y}=e.parentElement.getBoundingClientRect();return{width:i,height:f,top:v,left:y,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function xt(e){const n=J.get(e),o=n==null?void 0:n.fiber,i=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const f=typeof reportError=="function"?reportError:console.error,v=i||Et(je,Oe),y=o||se.createContainer(v,K.ConcurrentRoot,null,!1,null,"",f,null);n||J.set(e,{fiber:y,store:v});let g,d=!1,p;return{configure(t={}){let{gl:r,size:s,scene:l,events:u,onCreated:S,shadows:b=!1,linear:a=!1,flat:c=!1,legacy:m=!1,orthographic:P=!1,frameloop:M="always",dpr:R=[1,2],performance:T,raycaster:k,camera:I,onPointerMissed:x}=t,w=v.getState(),O=w.gl;w.gl||w.set({gl:O=Tt(r,e)});let z=w.raycaster;z||w.set({raycaster:z=new Ve});const{params:N,...V}=k||{};if(L.equ(V,z,$)||W(z,{...V}),L.equ(N,z.params,$)||W(z,{params:{...z.params,...N}}),!w.camera||w.camera===p&&!L.equ(p,I,$)){p=I;const _=I instanceof Qe,E=_?I:P?new We(0,0,0,0,.1,1e3):new $e(75,0,.1,1e3);_||(E.position.z=5,I&&(W(E,I),("aspect"in I||"left"in I||"right"in I||"bottom"in I||"top"in I)&&(E.manual=!0,E.updateProjectionMatrix())),!w.camera&&!(I!=null&&I.rotation)&&E.lookAt(0,0,0)),w.set({camera:E}),z.camera=E}if(!w.scene){let _;l!=null&&l.isScene?_=l:(_=new Xe,l&&W(_,l)),w.set({scene:X(_)})}if(!w.xr){var H;const _=(A,F)=>{const U=v.getState();U.frameloop!=="never"&&Oe(A,!0,U,F)},E=()=>{const A=v.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?_:null),A.gl.xr.isPresenting||je(A)},D={connect(){const A=v.getState().gl;A.xr.addEventListener("sessionstart",E),A.xr.addEventListener("sessionend",E)},disconnect(){const A=v.getState().gl;A.xr.removeEventListener("sessionstart",E),A.xr.removeEventListener("sessionend",E)}};typeof((H=O.xr)==null?void 0:H.addEventListener)=="function"&&D.connect(),w.set({xr:D})}if(O.shadowMap){const _=O.shadowMap.enabled,E=O.shadowMap.type;if(O.shadowMap.enabled=!!b,L.boo(b))O.shadowMap.type=le;else if(L.str(b)){var G;const D={basic:Ze,percentage:et,soft:le,variance:tt};O.shadowMap.type=(G=D[b])!=null?G:le}else L.obj(b)&&Object.assign(O.shadowMap,b);(_!==O.shadowMap.enabled||E!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const h=xe();h&&("enabled"in h?h.enabled=!m:"legacyMode"in h&&(h.legacyMode=m)),d||W(O,{outputEncoding:a?3e3:3001,toneMapping:c?Ye:Ke}),w.legacy!==m&&w.set(()=>({legacy:m})),w.linear!==a&&w.set(()=>({linear:a})),w.flat!==c&&w.set(()=>({flat:c})),r&&!L.fun(r)&&!He(r)&&!L.equ(r,O,$)&&W(O,r),u&&!w.events.handlers&&w.set({events:u(v)});const C=kt(e,s);return L.equ(C,w.size,$)||w.setSize(C.width,C.height,C.updateStyle,C.top,C.left),R&&w.viewport.dpr!==ze(R)&&w.setDpr(R),w.frameloop!==M&&w.setFrameloop(M),w.onPointerMissed||w.set({onPointerMissed:x}),T&&!L.equ(T,w.performance,$)&&w.set(_=>({performance:{..._.performance,...T}})),g=S,d=!0,this},render(t){return d||this.configure(),se.updateContainer(B.jsx(Dt,{store:v,children:t,onCreated:g,rootElement:e}),y,null,()=>{}),v},unmount(){Ge(e)}}}function Dt({store:e,children:n,onCreated:o,rootElement:i}){return ee(()=>{const f=e.getState();f.set(v=>({internal:{...v.internal,active:!0}})),o&&o(f),e.getState().events.connected||f.events.connect==null||f.events.connect(i)},[]),B.jsx(Ne.Provider,{value:e,children:n})}function Ge(e,n){const o=J.get(e),i=o==null?void 0:o.fiber;if(i){const f=o==null?void 0:o.store.getState();f&&(f.internal.active=!1),se.updateContainer(null,i,null,()=>{f&&setTimeout(()=>{try{var v,y,g,d;f.events.disconnect==null||f.events.disconnect(),(v=f.gl)==null||(y=v.renderLists)==null||y.dispose==null||y.dispose(),(g=f.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(d=f.gl)!=null&&d.xr&&f.xr.disconnect(),bt(f),J.delete(e)}catch{}},500)})}}se.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:j.version});const me={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function At(e){const{handlePointer:n}=Ct(e);return{priority:1,enabled:!0,compute(o,i,f){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(me).reduce((o,i)=>({...o,[i]:n(i)}),{}),update:()=>{var o;const{events:i,internal:f}=e.getState();(o=f.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(f.lastEvent.current)},connect:o=>{var i;const{set:f,events:v}=e.getState();v.disconnect==null||v.disconnect(),f(y=>({events:{...y.events,connected:o}})),Object.entries((i=v.handlers)!=null?i:[]).forEach(([y,g])=>{const[d,p]=me[y];o.addEventListener(d,g,{passive:p})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var f;Object.entries((f=i.handlers)!=null?f:[]).forEach(([v,y])=>{if(i&&i.connected instanceof HTMLElement){const[g]=me[v];i.connected.removeEventListener(g,y)}}),o(v=>({events:{...v.events,connected:void 0}}))}}}}const It=j.forwardRef(function({children:n,fallback:o,resize:i,style:f,gl:v,events:y=At,eventSource:g,eventPrefix:d,shadows:p,linear:t,flat:r,legacy:s,orthographic:l,frameloop:u,dpr:S,performance:b,raycaster:a,camera:c,scene:m,onPointerMissed:P,onCreated:M,...R},T){j.useMemo(()=>pt(ot),[]);const k=lt(),[I,x]=st({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=j.useRef(null),O=j.useRef(null);j.useImperativeHandle(T,()=>w.current);const z=Ae(P),[N,V]=j.useState(!1),[H,G]=j.useState(!1);if(N)throw N;if(H)throw H;const h=j.useRef(null);ee(()=>{const _=w.current;x.width>0&&x.height>0&&_&&(h.current||(h.current=xt(_)),h.current.configure({gl:v,events:y,shadows:p,linear:t,flat:r,legacy:s,orthographic:l,frameloop:u,dpr:S,performance:b,raycaster:a,camera:c,scene:m,size:x,onPointerMissed:(...E)=>z.current==null?void 0:z.current(...E),onCreated:E=>{E.events.connect==null||E.events.connect(g?ht(g)?g.current:g:O.current),d&&E.setEvents({compute:(D,A)=>{const F=D[d+"X"],U=D[d+"Y"];A.pointer.set(F/A.size.width*2-1,-(U/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),M==null||M(E)}}),h.current.render(B.jsx(k,{children:B.jsx(Ie,{set:G,children:B.jsx(j.Suspense,{fallback:B.jsx(mt,{set:V}),children:n??null})})})))}),j.useEffect(()=>{const _=w.current;if(_)return()=>Ge(_)},[]);const C=g?"none":"auto";return B.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:C,...f},...R,children:B.jsx("div",{ref:I,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:w,style:{display:"block"},children:o})})})}),Vt=j.forwardRef(function(n,o){return B.jsx(at,{children:B.jsx(It,{...n,ref:o})})});function _e(e,n){const o=e+"Geometry";return j.forwardRef(({args:i,children:f,...v},y)=>{const g=j.useRef(null);return j.useImperativeHandle(y,()=>g.current),j.useLayoutEffect(()=>void(n==null?void 0:n(g.current))),j.createElement("mesh",ct({ref:g},v),j.createElement(o,{attach:"geometry",args:i}),f)})}const Wt=_e("torus"),$t=_e("icosahedron"),Xt=_e("octahedron");export{Vt as C,$t as I,Xt as O,Wt as T,Ut as g,qt as u};
